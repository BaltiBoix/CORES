ts<-ts(filter(df1, CCAA == "España")$Gasolina, frequency=12, start = c(df1$Año[1],1))
comp<-decompose(ts, type = "multiplicative")
var.estacional$Gasolina<-comp$figure
pdf("CORES.pdf")
plotCCAA("España", c("2000-01-01", "end"))
plotCCAA("Cataluña", c("2000-01-01", "end"))
plotComb("Gasóleo", c("2000-01-01", "end"))
plotComb("Gasolina", c("2000-01-01", "end"))
grid.table(var.estacional, rows=rep("",12))
dev.off()
pdf("CORES.pdf")
plotCCAA("España", c("2000-01-01", "end"))
plotCCAA("Cataluña", c("2000-01-01", "end"))
plotComb("Gasóleo", c("2000-01-01", "end"))
plotComb("Gasolina", c("2000-01-01", "end"))
grid.newpage()
grid.table(var.estacional, rows=rep("",12))
dev.off()
var.estacional[,2:3]<-round(var.estacional[,2:3],3)
var.estacional
str(var.estacional)
summary(var.estacional)
ggplot(var.stacional)+geom_line(aes(x=mes, y=Gasóleo, group=1))
ggplot(var.estacional)+geom_line(aes(x=mes, y=Gasóleo, group=1))
var.estacional$mes<-factor(var.estacional$mes)
ggplot(var.estacional)+geom_line(aes(x=mes, y=Gasóleo, group=1))
var.estacional$mes<-factor(var.estacional$mes, levels=format(ISOdate(2000, 1:12, 1), "%B"))
ggplot(var.estacional)+geom_line(aes(x=mes, y=Gasóleo, group=1))
ggplot(var.estacional)+geom_line(aes(x=mes, y=Gasóleo, group=1))+geom_line(aes(x=mes, y=Gasolina, group=1))
ggplot(var.estacional)+geom_line(aes(x=mes, y=Gasóleo, group=1), color="green")+geom_line(aes(x=mes, y=Gasolina, group=1), color="blue")
var.estacional.g<-gather(data=var.estacional, key=Combustible, value=IndiceMensual, 2:3)
var.estacional.g
ggplot(var.estacional.g, aes(x=mes, y=IndiceMensual, color=Combustible))+geom_line()
ggplot(var.estacional.g, aes(x=mes, y=IndiceMensual, group=1, color=Combustible))+geom_line()
ggplot(var.estacional.g, aes(x=mes, y=IndiceMensual, group=2, color=Combustible))+geom_line()
ggplot(var.estacional.g, aes(x=mes, y=IndiceMensual, group=Combustible, color=Combustible))+geom_line()
var.estacional$Gasolina<-comp$figure
var.estacional.g<-gather(data=var.estacional, key=Combustible, value=IndiceMensual, 2:3)
var.estacional[,2:3]<-round(var.estacional[,2:3],3)
pdf("CORES.pdf")
plotCCAA("España", c("2000-01-01", "end"))
plotCCAA("Cataluña", c("2000-01-01", "end"))
plotComb("Gasóleo", c("2000-01-01", "end"))
plotComb("Gasolina", c("2000-01-01", "end"))
p<-ggplot(var.estacional.g, aes(x=mes, y=IndiceMensual, group=Combustible, color=Combustible))
p<-p+geom_line(size=2)
print(p)
grid.newpage()
grid.table(var.estacional, rows=rep("",12))
dev.off()
p<-ggplot(var.estacional.g, aes(x=mes, y=IndiceMensual, group=Combustible, color=Combustible))
p<-p+geom_line(size=2)
print(p)
p<-ggplot(var.estacional.g, aes(x=mes, y=IndiceMensual, group=Combustible, color=Combustible))
p<-p+geom_line(size=1.5)
p<-p+theme(axis.text.x=element_text(angle = 45))
print(p)
p<-ggplot(var.estacional.g, aes(x=mes, y=IndiceMensual, group=Combustible, color=Combustible))
p<-p+geom_line(size=1.5)
p<-p+theme(axis.text.x=element_text(angle = 45, hjust = 1))
print(p)
p<-p+geom_hline(intercept=1)
print(p)
p<-p+geom_hline(yintercept=1)
print(p)
p<-ggplot(var.estacional.g, aes(x=mes, y=IndiceMensual, group=Combustible, color=Combustible))
p<-p+geom_line(size=1.5)
p<-p+geom_hline(yintercept=1)
p<-p+theme(axis.text.x=element_text(angle = 45, hjust = 1))
print(p)
plotCCAA("Cataluña", c("2000-01-01", "end"))
source('~/CORES/cores.R', encoding = 'UTF-8', echo=TRUE)
??grid.newpage
dev.off()
pdf("CORES.pdf")
plotCCAA("España", c("2000-01-01", "end"))
plotCCAA("Cataluña", c("2000-01-01", "end"))
plotComb("Gasóleo", c("2000-01-01", "end"))
plotComb("Gasolina", c("2000-01-01", "end"))
p<-ggplot(var.estacional.g, aes(x=mes, y=IndiceMensual, group=Combustible, color=Combustible))
p<-p+geom_line(size=1.5)
p<-p+geom_hline(yintercept=1)
p<-p+theme(axis.text.x=element_text(angle = 45, hjust = 1))
print(p)
grid.newpage()
grid.table(var.estacional, rows=rep("",12))
dev.off()
dev.off()
require(grid, quietly = TRUE)
pdf("CORES.pdf")
plotCCAA("España", c("2000-01-01", "end"))
plotCCAA("Cataluña", c("2000-01-01", "end"))
plotComb("Gasóleo", c("2000-01-01", "end"))
plotComb("Gasolina", c("2000-01-01", "end"))
p<-ggplot(var.estacional.g, aes(x=mes, y=IndiceMensual, group=Combustible, color=Combustible))
p<-p+geom_line(size=1.5)
p<-p+geom_hline(yintercept=1)
p<-p+theme(axis.text.x=element_text(angle = 45, hjust = 1))
print(p)
grid.newpage()
grid.table(var.estacional, rows=rep("",12))
dev.off()
??grid.table
require(gridExtra, quietly = TRUE)
pdf("CORES.pdf")
plotCCAA("España", c("2000-01-01", "end"))
plotCCAA("Cataluña", c("2000-01-01", "end"))
plotComb("Gasóleo", c("2000-01-01", "end"))
plotComb("Gasolina", c("2000-01-01", "end"))
p<-ggplot(var.estacional.g, aes(x=mes, y=IndiceMensual, group=Combustible, color=Combustible))
p<-p+geom_line(size=1.5)
p<-p+geom_hline(yintercept=1)
p<-p+theme(axis.text.x=element_text(angle = 45, hjust = 1))
print(p)
grid.newpage()
grid.table(var.estacional, rows=rep("",12))
dev.off()
plot(ts)
??auto.arima
require(forecast, quietly = TRUE)
auto.arima(ts)
summary(auto.arima(ts))
acf(ts, lag.max = 20)
acf(ts, lag.max = 24)
fit<-Arima(ts, order = c(2,1,2))
fit
forecast.Arima(fit, h=5)
plot(forecast.Arima(fit, h=5))
plot(diff(ts))
plot(diff(diff(ts)))
plot(diff(diff(diff(ts))))
fit<-Arima(ts, order = c(2,3,2))
plot(forecast.Arima(fit, h=5))
plot(forecast.Arima(fit, h=12))
Box.test(fit$residuals, lag=20, type="Ljung-Box")
con <- dbConnect(MySQL(), dbname="mydb", host="localhost",client.flag=CLIENT_MULTI_STATEMENTS)
require(RMySQL)
con <- dbConnect(MySQL(), dbname="mydb", host="localhost",client.flag=CLIENT_MULTI_STATEMENTS)
con <- dbConnect(MySQL(), user="root", dbname="Energía", host="localhost",client.flag=CLIENT_MULTI_STATEMENTS)
con <- dbConnect(MySQL(), user="root", pass = "rp21984", dbname="Energía", host="localhost",client.flag=CLIENT_MULTI_STATEMENTS)
con <- dbConnect(MySQL(), user="root", pass = "rp21984", dbname="Energia", host="localhost",client.flag=CLIENT_MULTI_STATEMENTS)
con <- dbConnect(MySQL(), user="root", pass = "rp21984", dbname="Energy", host="localhost",client.flag=CLIENT_MULTI_STATEMENTS)
con <- dbConnect(MySQL(), user="root", pass = "rp21984", dbname="Energy", host="localhost",client.flag=CLIENT_MULTI_STATEMENTS)
con <- dbConnect(MySQL(), user="root", pass = "rp21984", dbname="Energy", host="localhost",client.flag=CLIENT_MULTI_STATEMENTS)
con <- dbConnect(MySQL(), user="root", pass = "rp21984", dbname="test", host="localhost",client.flag=CLIENT_MULTI_STATEMENTS)
dbListTables(con)
con <- dbConnect(MySQL(), user="root", pass = "rp21984", dbname="energy", host="localhost",client.flag=CLIENT_MULTI_STATEMENTS)
con <- dbConnect(MySQL(), user="root", pass = "rp21984", dbname="energy", host="localhost",client.flag=CLIENT_MULTI_STATEMENTS)
dbListTables(con)
?sqlsave
dbListTables(con)
?"dbWriteTable"
dbWriteTable(con, "CoresCCAA",df1)
df<-read.xlsx2("consumos.xlsx", sheetName="Consumos", startRow = 6, header = TRUE)
df<-filter(df, Año != "")
df<-select(df, -contains("bio"))
df1<-mutate(df, Date = as.Date(paste(Año, Mes, "1"), "%Y %B %d"))
for(i in 5:11)  {
df1[,i]<-round(as.numeric(as.character(df1[,i])),0)
}
df1[,5:11][is.na(df1[,5:11])]<-0
names(df1)<- str_replace_all(names(df1), "[^[:alnum:]]", "")
df1<-df1[, c(12, 1:11)]
levels(df1$CCAA) <- gsub("Total Nacional", "España", levels(df1$CCAA))
df1<-mutate(df1, Gasolina = Gasolina97IO + Gasolina95IO + Gasolina98IO)
df1<-mutate(df1, Gasóleo = GasóleoA + GasóleoB + GasóleoC)
require(xlsx, quietly = TRUE)
require(dplyr, quietly = TRUE)
require(ggplot2, quietly = TRUE)
require(stringr, quietly = TRUE)
require(tidyr, quietly = TRUE)
require(TTR, quietly = TRUE)
require(gridExtra, quietly = TRUE)
require(forecast, quietly = TRUE)
df<-read.xlsx2("consumos.xlsx", sheetName="Consumos", startRow = 6, header = TRUE)
df<-filter(df, Año != "")
df<-select(df, -contains("bio"))
df1<-mutate(df, Date = as.Date(paste(Año, Mes, "1"), "%Y %B %d"))
for(i in 5:11)  {
df1[,i]<-round(as.numeric(as.character(df1[,i])),0)
}
df1[,5:11][is.na(df1[,5:11])]<-0
names(df1)<- str_replace_all(names(df1), "[^[:alnum:]]", "")
df1<-df1[, c(12, 1:11)]
levels(df1$CCAA) <- gsub("Total Nacional", "España", levels(df1$CCAA))
df1<-mutate(df1, Gasolina = Gasolina97IO + Gasolina95IO + Gasolina98IO)
df1<-mutate(df1, Gasóleo = GasóleoA + GasóleoB + GasóleoC)
dbWriteTable(con, "CoresCCAA",df1)
source('~/RProjects/CORES/cores.R', encoding = 'UTF-8', echo=TRUE)
dev.off()
??grid.newpage()
require(grid, quietly = TRUE)
pdf("CORES.pdf")
plotCCAA("España", c("2000-01-01", "end"))
plotCCAA("Cataluña", c("2000-01-01", "end"))
plotComb("Gasóleo", c("2000-01-01", "end"))
plotComb("Gasolina", c("2000-01-01", "end"))
p<-ggplot(var.estacional.g, aes(x=mes, y=IndiceMensual, group=Combustible, color=Combustible))
p<-p+geom_line(size=1.5)
p<-p+geom_hline(yintercept=1)
p<-p+theme(axis.text.x=element_text(angle = 45, hjust = 1))
print(p)
grid.newpage()
grid.table(var.estacional, rows=rep("",12))
dev.off()
source('~/RProjects/CORES/cores1.R', encoding = 'UTF-8', echo=TRUE)
source('~/RProjects/CORES/cores1.R', encoding = 'UTF-8', echo=TRUE)
require(openxlsx, quietly = TRUE)
install.packages("openxlsx")
require(openxlsx, quietly = TRUE)
source('~/RProjects/CORES/cores1.R', encoding = 'UTF-8', echo=TRUE)
?read.xlsx
dftemp<-read.xlsx("consumos-pp.xlsx", sheet="GLPs", startRow = 6, header = TRUE)
dftemp<-read.xlsx("consumos-pp.xlsx", sheet="GLPs", startRow = 6)
View(dftemp)
source('~/RProjects/CORES/cores1.R', encoding = 'UTF-8', echo=TRUE)
source('~/RProjects/CORES/cores1.R', encoding = 'UTF-8', echo=TRUE)
source('~/RProjects/CORES/cores1.R', encoding = 'UTF-8', echo=TRUE)
dev.off()
pdf("CORES1.pdf")
dfg<-gather(data=df, key=producto, value=consumomensual, 3:37)
dfmag<-gather(data=dfma, key=producto, value=consumomensual, 3:37)
dfg<-filter(dfg, consumomensual > 10)
dfmag<-filter(dfmag, consumomensual > 10)
df1g<-filter(dfg, substring(producto,1,5) == "total")
df1mag<-filter(dfmag, substring(producto,1,5) == "total")
plotProducto()
df1g<-filter(dfg, grepl("glp", producto))
df1mag<-filter(dfmag, grepl("glp", producto))
plotProducto()
df1g<-filter(dfg, grepl("gasolina", producto))
df1mag<-filter(dfmag, grepl("gasolina", producto))
plotProducto()
df1g<-filter(dfg, producto %in% names(df)[20:27])
df1mag<-filter(dfmag, producto %in% names(df)[20:27])
plotProducto()
df1g<-filter(dfg, producto %in% names(df)[28:32])
df1mag<-filter(dfmag, producto %in% names(df)[28:32])
plotProducto()
df1g<-filter(dfg, producto %in% names(df)[33:37])
df1mag<-filter(dfmag, producto %in% names(df)[33:37])
plotProducto()
dev.off()
plotComb("Gasóleo", c("2010-01-01", "end"))
plotCCAA("España", c("2010-01-01", "end"))
plotCCAA("España", c("2014-01-01", "end"))
plotCCAA("Cataluña", c("2014-01-01", "end"))
p<-ggplot(var.estacional.g, aes(x=mes, y=IndiceMensual, group=Combustible, color=Combustible))
p<-p+geom_line(size=1.5)
p<-p+geom_hline(yintercept=1)
p<-p+theme(axis.text.x=element_text(angle = 45, hjust = 1))
print(p)
options( java.parameters = "-Xmx4g" )
require(openxlsx, quietly = TRUE)
require(dplyr, quietly = TRUE)
require(ggplot2, quietly = TRUE)
require(stringr, quietly = TRUE)
require(tidyr, quietly = TRUE)
require(TTR, quietly = TRUE)
if(!exists("plotCCAA")) source('plotCCAA.R', encoding="UTF-8")
if(!exists("plotComb")) source('plotCombustible.R', encoding="UTF-8")
if(!exists("plotProducto")) source('plotProducto.R', encoding="UTF-8")
if(!file.exists("consumos-pp.xlsx"))
download.file("http://www.cores.es/sites/default/files/archivos/estadisticas/consumos-pp.xlsx",
"consumos-pp.xlsx", mode = "wb")
dftemp<-read.xlsx("consumos-pp.xlsx", sheet="GLPs", startRow = 6)
dftemp<-filter(dftemp, Mes != "")
names(dftemp)<- tolower(str_replace_all(names(dftemp), "[^[:alnum:]]", ""))
names(dftemp)[3:7]<-c("glpenvasado", "glpgranel", "glpautomocion", "glpotros", "totalglps")
df<-dftemp
dftemp<-read.xlsx("consumos-pp.xlsx", sheet = "Gasolinas", startRow = 6, cols = 1:11)
dftemp<-filter(dftemp, Mes != "")
names(dftemp)<- tolower(str_replace_all(names(dftemp), "[^[:alnum:]]", ""))
names(dftemp)[11]<-"totalgasolinas"
df<-merge(df, dftemp)
dftemp<-read.xlsx("consumos-pp.xlsx", sheet = "Querosenos", startRow = 6, cols = 1:5)
dftemp<-filter(dftemp, Mes != "")
names(dftemp)<- tolower(str_replace_all(names(dftemp), "[^[:alnum:]]", ""))
names(dftemp)[3:5]<-c("kerosenoaviacion", "kerosenootros", "totalkerosenos")
df<-merge(df, dftemp)
dftemp<-read.xlsx("consumos-pp.xlsx", sheet = "Gasoleos", startRow = 6, cols = 1:10)
dftemp<-filter(dftemp, Mes != "")
names(dftemp)<- tolower(str_replace_all(names(dftemp), "[^[:alnum:]]", ""))
names(dftemp)[10]<-"totalgasoleos"
df<-merge(df, dftemp)
dftemp<-read.xlsx("consumos-pp.xlsx", sheet = "Fueloleos", startRow = 6, cols = 1:7)
dftemp<-filter(dftemp, Mes != "")
names(dftemp)<- tolower(str_replace_all(names(dftemp), "[^[:alnum:]]", ""))
names(dftemp)[7]<-"totalfueloleos"
df<-merge(df, dftemp)
dftemp<-read.xlsx("consumos-pp.xlsx", sheet = "Otros Productos", startRow = 6, cols = 1:7)
dftemp<-filter(dftemp, Mes != "")
names(dftemp)<- tolower(str_replace_all(names(dftemp), "[^[:alnum:]]", ""))
names(dftemp)[7]<-"totalotros"
df<-merge(df, dftemp)
names(df)<- str_replace_all(names(df), "ó", "o")
for(i in 3:37)  {
df[,i]<-round(as.numeric(as.character(df[,i])),0)
}
df[,3:37][is.na(df[,3:37])]<-0
df<-filter(df, mes != "total")
df<-mutate(df, date = as.Date(paste(año, mes, "1"), "%Y %B %d"))
df<-arrange(df, date)
for(i in 3:37){
for(j in 1:nrow(df)){
if(df[j, i] == 0) {
df[j, i]<-NA
}else{
break()
}
}
}
install.packages("openxlsx")
install.packages("TTR")
options( java.parameters = "-Xmx4g" )
require(openxlsx, quietly = TRUE)
require(dplyr, quietly = TRUE)
require(ggplot2, quietly = TRUE)
require(stringr, quietly = TRUE)
require(tidyr, quietly = TRUE)
require(TTR, quietly = TRUE)
if(!exists("plotCCAA")) source('plotCCAA.R', encoding="UTF-8")
if(!exists("plotComb")) source('plotCombustible.R', encoding="UTF-8")
if(!exists("plotProducto")) source('plotProducto.R', encoding="UTF-8")
if(!file.exists("consumos-pp.xlsx"))
download.file("http://www.cores.es/sites/default/files/archivos/estadisticas/consumos-pp.xlsx",
"consumos-pp.xlsx", mode = "wb")
dftemp<-read.xlsx("consumos-pp.xlsx", sheet="GLPs", startRow = 6)
dftemp<-filter(dftemp, Mes != "")
names(dftemp)<- tolower(str_replace_all(names(dftemp), "[^[:alnum:]]", ""))
names(dftemp)[3:7]<-c("glpenvasado", "glpgranel", "glpautomocion", "glpotros", "totalglps")
df<-dftemp
dftemp<-read.xlsx("consumos-pp.xlsx", sheet = "Gasolinas", startRow = 6, cols = 1:11)
dftemp<-filter(dftemp, Mes != "")
names(dftemp)<- tolower(str_replace_all(names(dftemp), "[^[:alnum:]]", ""))
names(dftemp)[11]<-"totalgasolinas"
df<-merge(df, dftemp)
dftemp<-read.xlsx("consumos-pp.xlsx", sheet = "Querosenos", startRow = 6, cols = 1:5)
dftemp<-filter(dftemp, Mes != "")
names(dftemp)<- tolower(str_replace_all(names(dftemp), "[^[:alnum:]]", ""))
names(dftemp)[3:5]<-c("kerosenoaviacion", "kerosenootros", "totalkerosenos")
df<-merge(df, dftemp)
dftemp<-read.xlsx("consumos-pp.xlsx", sheet = "Gasoleos", startRow = 6, cols = 1:10)
dftemp<-filter(dftemp, Mes != "")
names(dftemp)<- tolower(str_replace_all(names(dftemp), "[^[:alnum:]]", ""))
names(dftemp)[10]<-"totalgasoleos"
df<-merge(df, dftemp)
dftemp<-read.xlsx("consumos-pp.xlsx", sheet = "Fueloleos", startRow = 6, cols = 1:7)
dftemp<-filter(dftemp, Mes != "")
names(dftemp)<- tolower(str_replace_all(names(dftemp), "[^[:alnum:]]", ""))
names(dftemp)[7]<-"totalfueloleos"
df<-merge(df, dftemp)
dftemp<-read.xlsx("consumos-pp.xlsx", sheet = "Otros Productos", startRow = 6, cols = 1:7)
dftemp<-filter(dftemp, Mes != "")
names(dftemp)<- tolower(str_replace_all(names(dftemp), "[^[:alnum:]]", ""))
names(dftemp)[7]<-"totalotros"
df<-merge(df, dftemp)
names(df)<- str_replace_all(names(df), "ó", "o")
for(i in 3:37)  {
df[,i]<-round(as.numeric(as.character(df[,i])),0)
}
df[,3:37][is.na(df[,3:37])]<-0
df<-filter(df, mes != "total")
df<-mutate(df, date = as.Date(paste(año, mes, "1"), "%Y %B %d"))
df<-arrange(df, date)
for(i in 3:37){
for(j in 1:nrow(df)){
if(df[j, i] == 0) {
df[j, i]<-NA
}else{
break()
}
}
}
View(df)
require(RSQLite)
?SQLite
con <- dbConnect(SQLite(), "CORES.sqlite")
dbWriteTable(con, 'Consumos',df)
dbDisconnect(con)
require(xlsx, quietly = TRUE)
install.packages('xlsx')
install.packages('xlsx')
install.packages('xlsx')
require(dplyr, quietly = TRUE)
require(ggplot2, quietly = TRUE)
require(stringr, quietly = TRUE)
require(tidyr, quietly = TRUE)
require(TTR, quietly = TRUE)
require(grid, quietly = TRUE)
require(gridExtra, quietly = TRUE)
require(forecast, quietly = TRUE)
install.packages('forecast')
require(forecast, quietly = TRUE)
if(!exists("plotCCAA")) source('plotCCAA.R', encoding="UTF-8")
if(!exists("plotComb")) source('plotCombustible.R', encoding="UTF-8")
download.file("http://www.cores.es/sites/default/files/archivos/estadisticas/consumos-pp-ccaa-provincias.xlsx",
"consumos.xlsx", mode = "wb")
source('~/RProjects/CORES/cores.R', encoding = 'UTF-8', echo=TRUE)
df<-read.xlsx("consumos.xlsx", sheetName="Consumos", startRow = 6, header = TRUE)
require(openxlsx, quietly = TRUE)
df<-read.xlsx("consumos.xlsx", sheetName="Consumos", startRow = 6, header = TRUE)
df<-read.xlsx("consumos.xlsx", sheet="Consumos", startRow = 6)
df<-filter(df, Año != "")
df<-select(df, -contains("bio"))
df1<-mutate(df, Date = as.Date(paste(Año, Mes, "1"), "%Y %B %d"))
for(i in 5:11)  {
df1[,i]<-round(as.numeric(as.character(df1[,i])),0)
}
df1[,5:11][is.na(df1[,5:11])]<-0
names(df1)<- str_replace_all(names(df1), "[^[:alnum:]]", "")
df1<-df1[, c(12, 1:11)]
levels(df1$CCAA) <- gsub("Total Nacional", "España", levels(df1$CCAA))
df1<-mutate(df1, Gasolina = Gasolina97IO + Gasolina95IO + Gasolina98IO)
df1<-mutate(df1, Gasóleo = GasóleoA + GasóleoB + GasóleoC)
df1ma<-df1
df1ma<-mutate(df1ma, ind=paste0(CCAA, Provincia))
lista<-distinct(select(df1ma, ind))
for(j in 1:nrow(lista)){
for(i in 6:14)  {
df1ma[df1ma$ind==lista$ind[j],i]<-round(SMA(df1ma[df1ma$ind==lista$ind[j],i], n=12),0)
}
}
df1ma<-select(df1ma, -ind)
ts<-ts(filter(df1, CCAA == "España")$Gasóleo, frequency=12, start = c(df1$Año[1],1))
comp<-decompose(ts, type = "multiplicative")
var.estacional<-data.frame(mes=format(ISOdate(2000, 1:12, 1), "%B"), Gasóleo=comp$figure)
var.estacional$mes<-factor(var.estacional$mes, levels=format(ISOdate(2000, 1:12, 1), "%B"))
ts<-ts(filter(df1, CCAA == "España")$Gasolina, frequency=12, start = c(df1$Año[1],1))
comp<-decompose(ts, type = "multiplicative")
var.estacional$Gasolina<-comp$figure
var.estacional.g<-gather(data=var.estacional, key=Combustible, value=IndiceMensual, 2:3)
var.estacional[,2:3]<-round(var.estacional[,2:3],3)
View(df1)
c(df1$Año[1],1)
levels(df1$CCAA)
lista
View(df1ma)
names(df1)
View(df1ma)
View(df)
df<-read.xlsx("consumos.xlsx", sheet="Consumos", startRow = 6)
df<-filter(df, Año != "")
df<-filter(df, Año > 1997 & Año < 2020)
df<-select(df, -contains("bio"))
df1<-mutate(df, Date = as.Date(paste(Año, Mes, "1"), "%Y %B %d"))
for(i in 5:11)  {
df1[,i]<-round(as.numeric(as.character(df1[,i])),0)
}
df1[,5:11][is.na(df1[,5:11])]<-0
names(df1)<- str_replace_all(names(df1), "[^[:alnum:]]", "")
df1<-df1[, c(12, 1:11)]
levels(df1$CCAA) <- gsub("Total Nacional", "España", levels(df1$CCAA))
df1<-mutate(df1, Gasolina = Gasolina97IO + Gasolina95IO + Gasolina98IO)
df1<-mutate(df1, Gasóleo = GasóleoA + GasóleoB + GasóleoC)
df1ma<-df1
df1ma<-mutate(df1ma, ind=paste0(CCAA, Provincia))
lista<-distinct(select(df1ma, ind))
for(j in 1:nrow(lista)){
for(i in 6:14)  {
df1ma[df1ma$ind==lista$ind[j],i]<-round(SMA(df1ma[df1ma$ind==lista$ind[j],i], n=12),0)
}
}
df1ma<-select(df1ma, -ind)
ts<-ts(filter(df1, CCAA == "España")$Gasóleo, frequency=12, start = c(df1$Año[1],1))
unique(df1$CCAA)
levels(df1$CCAA)
df1$CCAA <- gsub("Total Nacional", "España", df1$CCAA)
unique(df1$CCAA)
df1<-mutate(df, Date = as.Date(paste(Año, Mes, "1"), "%Y %B %d"))
for(i in 5:11)  {
df1[,i]<-round(as.numeric(as.character(df1[,i])),0)
}
df1[,5:11][is.na(df1[,5:11])]<-0
names(df1)<- str_replace_all(names(df1), "[^[:alnum:]]", "")
df1<-df1[, c(12, 1:11)]
df1$CCAA <- gsub("Total Nacional", "España", df1$CCAA)
df1<-mutate(df1, Gasolina = Gasolina97IO + Gasolina95IO + Gasolina98IO)
df1<-mutate(df1, Gasóleo = GasóleoA + GasóleoB + GasóleoC)
df1ma<-df1
df1ma<-mutate(df1ma, ind=paste0(CCAA, Provincia))
lista<-distinct(select(df1ma, ind))
for(j in 1:nrow(lista)){
for(i in 6:14)  {
df1ma[df1ma$ind==lista$ind[j],i]<-round(SMA(df1ma[df1ma$ind==lista$ind[j],i], n=12),0)
}
}
df1ma<-select(df1ma, -ind)
ts<-ts(filter(df1, CCAA == "España")$Gasóleo, frequency=12, start = c(df1$Año[1],1))
comp<-decompose(ts, type = "multiplicative")
var.estacional<-data.frame(mes=format(ISOdate(2000, 1:12, 1), "%B"), Gasóleo=comp$figure)
var.estacional$mes<-factor(var.estacional$mes, levels=format(ISOdate(2000, 1:12, 1), "%B"))
ts<-ts(filter(df1, CCAA == "España")$Gasolina, frequency=12, start = c(df1$Año[1],1))
comp<-decompose(ts, type = "multiplicative")
var.estacional$Gasolina<-comp$figure
var.estacional.g<-gather(data=var.estacional, key=Combustible, value=IndiceMensual, 2:3)
var.estacional[,2:3]<-round(var.estacional[,2:3],3)
pdf("CORES.pdf")
plotCCAA("España", c("2000-01-01", "end"))
plotCCAA("Cataluña", c("2000-01-01", "end"))
plotComb("Gasóleo", c("2000-01-01", "end"))
plotComb("Gasolina", c("2000-01-01", "end"))
p<-ggplot(var.estacional.g, aes(x=mes, y=IndiceMensual, group=Combustible, color=Combustible))
p<-p+geom_line(size=1.5)
p<-p+geom_hline(yintercept=1)
p<-p+theme(axis.text.x=element_text(angle = 45, hjust = 1))
print(p)
grid.newpage()
grid.table(var.estacional, rows=rep("",12))
dev.off()
source('~/RProjects/CORES/cores1.R', encoding = 'UTF-8', echo=TRUE)
source('~/RProjects/CORES/cores1.R', encoding = 'UTF-8', echo=TRUE)
