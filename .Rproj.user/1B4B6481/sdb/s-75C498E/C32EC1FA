{
    "contents" : "options( java.parameters = \"-Xmx4g\" )\nrequire(xlsx, quietly = TRUE)\nrequire(dplyr, quietly = TRUE)\nrequire(ggplot2, quietly = TRUE)\nrequire(stringr, quietly = TRUE)\nrequire(tidyr, quietly = TRUE)\nrequire(TTR, quietly = TRUE)\nif(!exists(\"plotCCAA\")) source('plotCCAA.R', encoding=\"UTF-8\")\nif(!exists(\"plotComb\")) source('plotCombustible.R', encoding=\"UTF-8\")\n\nif(!file.exists(\"consumos-pp.xlsx\")) \n      download.file(\"http://www.cores.es/sites/default/files/archivos/estadisticas/consumos-pp.xlsx\", \n      \"consumos-pp.xlsx\", mode = \"wb\")\n\ndftemp<-read.xlsx2(\"consumos-pp.xlsx\", sheetName=\"GLPs\", startRow = 6, header = TRUE)\ndftemp<-filter(dftemp, Mes != \"\")\nnames(dftemp)<- tolower(str_replace_all(names(dftemp), \"[^[:alnum:]]\", \"\"))\nnames(dftemp)[3:7]<-c(\"glpenvasado\", \"glpgranel\", \"glpautomocion\", \"glpotros\", \"totalglps\")\n\ndf<-dftemp\n\ndftemp<-read.xlsx2(\"consumos-pp.xlsx\", sheetName = \"Gasolinas\", startRow = 6, colIndex = 1:11, header = TRUE)\ndftemp<-filter(dftemp, Mes != \"\")\nnames(dftemp)<- tolower(str_replace_all(names(dftemp), \"[^[:alnum:]]\", \"\"))\nnames(dftemp)[11]<-\"totalgasolinas\"\n\ndf<-merge(df, dftemp)\n\ndftemp<-read.xlsx2(\"consumos-pp.xlsx\", sheetName = \"Querosenos\", startRow = 6, colIndex = 1:5, header = TRUE)\ndftemp<-filter(dftemp, Mes != \"\")\nnames(dftemp)<- tolower(str_replace_all(names(dftemp), \"[^[:alnum:]]\", \"\"))\nnames(dftemp)[3:5]<-c(\"kerosenoaviacion\", \"kerosenootros\", \"totalkerosenos\")\n\ndf<-merge(df, dftemp)\n\ndftemp<-read.xlsx2(\"consumos-pp.xlsx\", sheetName = \"Gasoleos\", startRow = 6, colIndex = 1:10, header = TRUE)\ndftemp<-filter(dftemp, Mes != \"\")\nnames(dftemp)<- tolower(str_replace_all(names(dftemp), \"[^[:alnum:]]\", \"\"))\nnames(dftemp)[10]<-\"totalgasoleos\"\n\ndf<-merge(df, dftemp)\n\ndftemp<-read.xlsx2(\"consumos-pp.xlsx\", sheetName = \"Fueloleos\", startRow = 6, colIndex = 1:7, header = TRUE)\ndftemp<-filter(dftemp, Mes != \"\")\nnames(dftemp)<- tolower(str_replace_all(names(dftemp), \"[^[:alnum:]]\", \"\"))\nnames(dftemp)[7]<-\"totalfueloleos\"\n\ndf<-merge(df, dftemp)\n\ndftemp<-read.xlsx2(\"consumos-pp.xlsx\", sheetName = \"Otros Productos\", startRow = 6, colIndex = 1:7, header = TRUE)\ndftemp<-filter(dftemp, Mes != \"\")\nnames(dftemp)<- tolower(str_replace_all(names(dftemp), \"[^[:alnum:]]\", \"\"))\nnames(dftemp)[7]<-\"totalotros\"\n\ndf<-merge(df, dftemp)\n\nnames(df)<- str_replace_all(names(df), \"ó\", \"o\")\n\nfor(i in 3:37)  {\n      df[,i]<-round(as.numeric(as.character(df[,i])),0)\n}\n\ndf[,3:37][is.na(df[,3:37])]<-0\n\ndf<-filter(df, mes != \"total\")\n\ndf<-mutate(df, date = as.Date(paste(año, mes, \"1\"), \"%Y %B %d\"))\ndf<-arrange(df, date)\n\nfor(i in 3:37){\n      for(j in 1:nrow(df)){\n            if(df[j, i] == 0) {\n                  df[j, i]<-NA\n            }else{\n                  break()\n            }\n      }\n}\n\ndfma<-df\nfor(i in 3:37){\n      dfma[,i]<-round(SMA(dfma[,i], n=12),0)\n}\n\n\npdf(\"CORES1.pdf\")\n\ndfg<-gather(data=df, key=producto, value=consumomensual, 3:37)\ndfmag<-gather(data=dfma, key=producto, value=consumomensual, 3:37)\n\ndfg<-filter(dfg, consumomensual > 10)\ndfmag<-filter(dfmag, consumomensual > 10)\n\ndf1g<-filter(dfg, substring(producto,1,5) == \"total\")\ndf1mag<-filter(dfmag, substring(producto,1,5) == \"total\")\n\nplotProducto()\n\ndf1g<-filter(dfg, grepl(\"glp\", producto))\ndf1mag<-filter(dfmag, grepl(\"glp\", producto))\n\nplotProducto()\n\ndf1g<-filter(dfg, grepl(\"gasolina\", producto))\ndf1mag<-filter(dfmag, grepl(\"gasolina\", producto))\n\nplotProducto()\n\ndf1g<-filter(dfg, producto %in% names(df)[20:27])\ndf1mag<-filter(dfmag, producto %in% names(df)[20:27])\n\nplotProducto()\n\ndf1g<-filter(dfg, producto %in% names(df)[28:32])\ndf1mag<-filter(dfmag, producto %in% names(df)[28:32])\n\nplotProducto()\n\ndf1g<-filter(dfg, producto %in% names(df)[33:37])\ndf1mag<-filter(dfmag, producto %in% names(df)[33:37])\n\nplotProducto()\n\ndev.off()",
    "created" : 1446153177200.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1765860926",
    "id" : "C32EC1FA",
    "lastKnownWriteTime" : 1446232310,
    "path" : "~/CORES/cores1.R",
    "project_path" : "cores1.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "type" : "r_source"
}